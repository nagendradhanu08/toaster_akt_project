{"version":3,"file":"expiry-format.directive.js","sourceRoot":"","sources":["../../src/directives/expiry-format.directive.ts"],"names":[],"mappings":"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","sourcesContent":["import { Directive, ElementRef, HostListener } from '@angular/core';\nimport { CreditCard } from '../shared/credit-card';\n\n@Directive({\n  selector: '[ccExp]'\n})\n\nexport class ExpiryFormatDirective {\n\n  public target;\n\n  constructor(private el: ElementRef) {\n    this.target = this.el.nativeElement;\n  }\n\n  @HostListener('keypress', ['$event']) onKeypress(e) {\n    if (CreditCard.restrictNumeric(e)) {\n      if (CreditCard.restrictExpiry(e.which, this.target)) {\n        this.formatExpiry(e);\n        this.formatForwardSlashAndSpace(e);\n        this.formatForwardExpiry(e);\n      }\n    } else {\n      e.preventDefault();\n      return false;\n    }\n  }\n  @HostListener('keydown', ['$event']) onKeydown(e) {\n    if (CreditCard.restrictNumeric(e) && CreditCard.restrictExpiry(e.which, this.target)) {\n      this.formatBackExpiry(e);\n    }\n  }\n  @HostListener('change', ['$event']) onChange(e) {\n    this.reformatExpiry(e);\n  }\n  @HostListener('input', ['$event']) onInput(e) {\n    this.reformatExpiry(e);\n  }\n\n  private formatExpiry(e) {\n    let digit = String.fromCharCode(e.which),\n        val   = `${this.target.value}${digit}`;\n\n    if (!/^\\d+$/.test(digit)) {\n      if (/^\\d$/.test(val) && (val !== '0' && val !== '1')) {\n        e.preventDefault();\n        setTimeout(() => {\n          this.target.value = `0${val} / `;\n        });\n      } else if (/^\\d\\d$/.test(val)) {\n        e.preventDefault();\n        setTimeout(() => {\n          let m1 = parseInt(val[0], 10),\n              m2 = parseInt(val[1], 10);\n          if (m2 > 2 && m1 !== 0) {\n            this.target.value = `0${m1} / ${m2}`;\n          } else {\n            this.target.value = `${val} / `;\n          }\n        });\n      }\n    }\n  }\n\n  private formatForwardSlashAndSpace(e) {\n    let which = String.fromCharCode(e.which),\n        val   = this.target.value;\n\n    if (!(which === '/' || which === ' ')) {\n      return false;\n    }\n    if (/^\\d$/.test(val) && val !== '0') {\n      this.target.value = `0${val} / `;\n    }\n  }\n\n  private formatForwardExpiry(e) {\n    let digit = String.fromCharCode(e.which),\n        val   = this.target.value;\n\n    if (!/^\\d+$/.test(digit) && /^\\d\\d$/.test(val)) {\n      this.target.value = `${val} / `;\n    }\n  }\n\n  private formatBackExpiry(e) {\n    let val = this.target.valueOf;\n\n    if (e.which !== 8) {\n      return;\n    }\n    if ((this.target.selectionStart != null) && this.target.selectionStart !== val.length) {\n      return;\n    }\n    if (/\\d\\s\\/\\s$/.test(val)) {\n      e.preventDefault();\n      setTimeout(function() {\n        this.target.value = val.replace(/\\d\\s\\/\\s$/, '');\n      });\n    }\n  }\n\n  private reformatExpiry(e) {\n    setTimeout(() => {\n      let val = this.target.value;\n      val = CreditCard.replaceFullWidthChars(val);\n      val = CreditCard.formatExpiry(val);\n      this.target.selectionStart = this.target.selectionEnd = CreditCard.safeVal(val, this.target);\n    });\n  }\n\n}\n"]}